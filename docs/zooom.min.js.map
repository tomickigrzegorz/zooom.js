{"version":3,"file":"zooom.min.js","sources":["../sources/js/utils/function.ts","../sources/js/index.ts"],"sourcesContent":["/**\r\n * @function fadeIn - fade in overlay div layer\r\n *\r\n * @param {HTMLDivElement} overlay - add class and opacity to overlay div layer\r\n * @param {Stieng} bgrWithOpacity - opacity of overlay div layer\r\n */\r\nconst fadeIn = (overlay: HTMLDivElement, bgrWithOpacity?: string) => {\r\n  overlay.className = \"zooom-overlay-in\";\r\n  overlay.style.pointerEvents = \"auto\";\r\n  overlay.style.background = String(bgrWithOpacity);\r\n};\r\n\r\n/**\r\n * @function fadeOut - fade out overlay div layer\r\n *\r\n * @param {HTMLDivElement} overlay - remove class and style from overlay div\r\n */\r\nconst fadeOut = (overlay: HTMLDivElement) => {\r\n  overlay.classList.remove(\"zooom-overlay-in\");\r\n  overlay.removeAttribute(\"style\");\r\n};\r\n\r\n/**\r\n * @function debounce - debounce function\r\n *\r\n * @param {Function} fn function\r\n * @param {Number} ms time\r\n */\r\nconst debounce = (fn: Function, ms = 300) => {\r\n  let timeoutId: ReturnType<typeof setTimeout>;\r\n  return function (this: any, ...args: any[]) {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => fn.apply(this, args), ms);\r\n  };\r\n};\r\n\r\nexport { fadeIn, fadeOut, debounce };\r\n","import { fadeIn, fadeOut, debounce } from \"./utils/function\";\r\n\r\n/**\r\n * @class Zooom\r\n */\r\nexport default class Zooom {\r\n  private _element: string;\r\n  private _dataAttr: string;\r\n  private _overlayId: string;\r\n  private _imageZooom: any;\r\n  private _clonedImg: HTMLImageElement;\r\n  private _zIndex: number;\r\n  private _cursorIn?: string;\r\n  private _cursorOut?: string;\r\n  private _overlay?: string;\r\n  private _animTime?: number;\r\n  private _overlayLayer: HTMLDivElement;\r\n  private _onResize: Function;\r\n  private _onOpen: Function;\r\n  private _onClose: Function;\r\n\r\n  /**\r\n   * @constructor\r\n   *\r\n   * @param className\r\n   * @param object\r\n   */\r\n  constructor(\r\n    className: string,\r\n    {\r\n      zIndex,\r\n      animationTime,\r\n      cursor,\r\n      overlay,\r\n      onResize = () => {},\r\n      onOpen = () => {},\r\n      onClose = () => {},\r\n    }: ConstructorObject\r\n  ) {\r\n    this._element = className;\r\n    this._animTime = animationTime || 300;\r\n    this._zIndex = zIndex || 1;\r\n    this._dataAttr = \"data-zoomed\";\r\n    this._overlayId = \"zooom-overlay\";\r\n    this._overlayLayer = document.createElement(\"div\");\r\n    this._clonedImg = document.createElement(\"img\");\r\n\r\n    // callback function\r\n    this._onResize = onResize;\r\n    this._onOpen = onOpen;\r\n    this._onClose = onClose;\r\n\r\n    this._overlay = overlay;\r\n\r\n    // create cursor\r\n    this._cursorType(cursor);\r\n\r\n    // create overlay\r\n    // this.overlayConfig(overlay);\r\n\r\n    // creating overlay layer and adding to body\r\n    this._overlayLayer.id = this._overlayId;\r\n    document.body.appendChild(this._overlayLayer);\r\n\r\n    // add to all image data attribute false\r\n    [].slice\r\n      .call(document.querySelectorAll(`.${className}`))\r\n      .map((element: HTMLElement) => {\r\n        element.setAttribute(\"data-zoomed\", \"false\");\r\n      });\r\n\r\n    // add event listener\r\n    this._eventHandle();\r\n\r\n    // create style and add to head\r\n    this._createStyleAndAddToHead();\r\n  }\r\n\r\n  /**\r\n   * @method eventHandle - add event listener\r\n   */\r\n  _eventHandle = () => {\r\n    window.addEventListener(\r\n      \"resize\",\r\n      debounce(() => this._event(), 70)\r\n    );\r\n\r\n    window.addEventListener(\"DOMContentLoaded\", this._event);\r\n  };\r\n\r\n  /**\r\n   * @method event - scroll, resize, click event\r\n   */\r\n  _event = () => {\r\n    [\"scroll\", \"resize\", \"click\"].map((type) => {\r\n      if (this._onResize()) {\r\n        window.removeEventListener(\r\n          type,\r\n          type === \"click\" ? this._handleClick : this._handleEvent\r\n        );\r\n      } else {\r\n        window.addEventListener(\r\n          type,\r\n          type === \"click\" ? this._handleClick : this._handleEvent\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * @method handleClick - click event\r\n   *\r\n   * @param {Object} cursor - cursor type\r\n   */\r\n  _cursorType = (\r\n    { in: zIn, out: zOut }: ObjectCursor = { in: \"zoom-in\", out: \"zoom-out\" }\r\n  ) => {\r\n    this._cursorIn = `cursor: ${zIn}`;\r\n    this._cursorOut = `cursor: ${zOut};`;\r\n  };\r\n\r\n  /**\r\n   * @method handleClick - click event\r\n   *\r\n   * @param {Event} event - event\r\n   */\r\n  _handleClick = (event: any) => {\r\n    let { target } = event;\r\n    const dataZoomed = target.getAttribute(this._dataAttr);\r\n\r\n    if (dataZoomed === \"false\") {\r\n      const bigImage = target.getAttribute(\"data-zooom-big\");\r\n\r\n      if (bigImage) {\r\n        this._loadImage(target, bigImage).then(() => {\r\n          this._imageZooom = target;\r\n          this._zooomInit();\r\n          document.body.classList.remove(\"zooom-loading\");\r\n        });\r\n      } else {\r\n        this._imageZooom = target;\r\n        this._zooomInit();\r\n      }\r\n    } else if (dataZoomed === \"true\" || target.id === this._overlayId) {\r\n      this._handleEvent();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @method loadImage - cload image if data-zooom-big is set\r\n   *\r\n   * @param {HTMLImageElement} target\r\n   * @param {String} bigImage\r\n   */\r\n  _loadImage = (target: HTMLImageElement, bigImage: string) => {\r\n    return new Promise<string>((resolve, reject) => {\r\n      let newImage = new Image();\r\n\r\n      newImage.onload = function () {\r\n        resolve(\"image loaded\");\r\n      };\r\n      newImage.onerror = function () {\r\n        reject(`image ${bigImage} not loaded`);\r\n      };\r\n\r\n      document.body.classList.add(\"zooom-loading\");\r\n\r\n      newImage.src = bigImage;\r\n      target.src = newImage.src;\r\n      target.removeAttribute(\"data-zooom-big\");\r\n    });\r\n  };\r\n\r\n  /**\r\n   * @method handleEvent\r\n   */\r\n  _handleEvent = () => {\r\n    const imagezooom = document.querySelector(`[${this._dataAttr}=\"true\"]`);\r\n\r\n    if (!imagezooom) return;\r\n\r\n    // reset all style\r\n    this._reset();\r\n\r\n    setTimeout(() => {\r\n      imagezooom.setAttribute(this._dataAttr, \"false\");\r\n    }, this._animTime);\r\n    // callback function onClose\r\n    this._onClose(this._imageZooom);\r\n    fadeOut(this._overlayLayer);\r\n  };\r\n\r\n  /**\r\n   * @method createStyleAndAddToHead - create style and add to head\r\n   */\r\n  _createStyleAndAddToHead = () => {\r\n    const background = `#zooom-overlay{position:fixed;pointer-events:none;width:100%;background:rgba(255,255,255,0);height:100%;top:0;justify-content:center;align-items:center;z-index:${this._zIndex};margin:auto;-webkit-transition:background ${this._animTime}ms ease-in-out;transition:background ${this._animTime}ms ease-in-out;${this._cursorOut}}`;\r\n\r\n    const css = `.${this._element}{${\r\n      this._cursorIn\r\n    }};@-webkit-keyframes zooom-fade{0%{opacity:0}}@keyframes zooom-fade{0%{opacity:0}}[data-zoomed=\"true\"]{${\r\n      this._cursorOut\r\n    }position:relative;z-index:${this._zIndex + 9};transition:transform ${\r\n      this._animTime\r\n    }ms ease-in-out;}`;\r\n\r\n    document.head.insertAdjacentHTML(\r\n      \"beforeend\",\r\n      `<style>${css}${background}</style>`\r\n    );\r\n  };\r\n\r\n  /**\r\n   * @method zooomInit - fadein, callback function onOpen, cloneImg\r\n   */\r\n  _zooomInit = () => {\r\n    this._imageZooom.setAttribute(this._dataAttr, \"true\");\r\n\r\n    this._cloneImg(this._imageZooom);\r\n\r\n    fadeIn(this._overlayLayer, this._overlay);\r\n\r\n    // callback function\r\n    this._onOpen(this._imageZooom);\r\n  };\r\n\r\n  /**\r\n   * @method cloneImg - clone image\r\n   *\r\n   * @param {HTMLImageElement} image - clone image and add to overlay layer\r\n   */\r\n  _cloneImg = (image: HTMLImageElement) => {\r\n    let src = image.currentSrc || image.src;\r\n\r\n    let { width, height, left, top } = image.getBoundingClientRect();\r\n\r\n    const { clientWidth, clientHeight, offsetWidth } = document.documentElement;\r\n\r\n    const scrollTop =\r\n      window.pageYOffset ||\r\n      document.documentElement.scrollTop ||\r\n      document.body.scrollTop ||\r\n      0;\r\n\r\n    const scroll = clientWidth - offsetWidth;\r\n\r\n    const X = (clientWidth - scroll) / 2 - left - width / 2;\r\n    const Y = -top + (clientHeight - height) / 2;\r\n\r\n    const ratio = height / width;\r\n\r\n    let maxWidth = image.naturalWidth;\r\n\r\n    maxWidth >= clientWidth && (maxWidth = clientWidth);\r\n    const maxHeight = maxWidth * ratio;\r\n    maxHeight >= clientHeight &&\r\n      (maxWidth = (maxWidth * clientHeight) / maxHeight);\r\n\r\n    const scale = maxWidth !== width ? maxWidth / width : 1;\r\n\r\n    const img = this._clonedImg;\r\n\r\n    img.src = src;\r\n    img.width = width;\r\n    img.height = height;\r\n    img.style.top = `${top + scrollTop}px`;\r\n    img.style.left = `${left}px`;\r\n    img.style.width = `${width}px`;\r\n    img.style.height = `${height}px`;\r\n    img.className = \"zooom-clone\";\r\n\r\n    document.body.appendChild(img);\r\n\r\n    img.offsetWidth;\r\n    img.setAttribute(\"data-zoomed\", \"true\");\r\n    img.style.position = \"absolute\";\r\n    img.style.transform = `matrix(${scale},0,0,${scale},${X},${Y})`;\r\n\r\n    // hide orginal image\r\n    setTimeout(() => {\r\n      this._imageZooom.style.setProperty(\"visibility\", \"hidden\");\r\n    }, 50);\r\n\r\n    // remove image\r\n    img.addEventListener(\"click\", this._reset);\r\n  };\r\n\r\n  /**\r\n   * @method reset - reset all style\r\n   */\r\n  _reset = () => {\r\n    this._clonedImg.style.removeProperty(\"transform\");\r\n    setTimeout(() => {\r\n      this._clonedImg.parentNode?.removeChild(this._clonedImg);\r\n      this._imageZooom.style.removeProperty(\"visibility\");\r\n    }, this._animTime);\r\n  };\r\n}\r\n"],"names":["debounce","fn","ms","timeoutId","args","clearTimeout","setTimeout","apply","this","[object Object]","className","zIndex","animationTime","cursor","overlay","onResize","onOpen","onClose","_eventHandle","window","addEventListener","_event","map","type","_onResize","removeEventListener","_handleClick","_handleEvent","_cursorType","in","zIn","out","zOut","_cursorIn","_cursorOut","event","target","dataZoomed","getAttribute","_dataAttr","bigImage","_loadImage","then","_imageZooom","_zooomInit","document","body","classList","remove","id","_overlayId","Promise","resolve","reject","newImage","Image","onload","onerror","add","src","removeAttribute","imagezooom","querySelector","_reset","setAttribute","_animTime","_onClose","fadeOut","_overlayLayer","_createStyleAndAddToHead","background","_zIndex","css","_element","head","insertAdjacentHTML","_cloneImg","bgrWithOpacity","style","pointerEvents","String","fadeIn","_overlay","_onOpen","image","currentSrc","width","height","left","top","getBoundingClientRect","clientWidth","clientHeight","offsetWidth","documentElement","scrollTop","pageYOffset","X","Y","ratio","maxWidth","naturalWidth","maxHeight","scale","img","_clonedImg","appendChild","position","transform","setProperty","removeProperty","_a","parentNode","removeChild","createElement","slice","call","querySelectorAll","element"],"mappings":"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"}